<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>
    <record model="ir.ui.view" id="crm_case_inbound_phone_tree_view">
      <field name="name">CRM - Phone Calls Survey</field>
      <field name="model">crm.phonecall</field>
      <field name="inherit_id" ref="crm_phonecall.crm_case_inbound_phone_tree_view" />
      <field name="arch" type="xml">
        <button name="action_make_meeting" position='after'>
          <button string="Survey" name="action_make_survey" icon="fa-edit" type="object" />
        </button>
      </field>
    </record>
    <!-- survey-user_input   lead/opportunity/phonecall/res_partner-->
    <record model="ir.ui.view" id="crm_case_form_view_leads">
      <field name="name">CRM - Leads Form</field>
      <field name="model">crm.lead</field>
      <field name="inherit_id" ref="crm.crm_case_form_view_leads" />
      <field name="groups_id" eval="[(4, ref('sales_team.group_sale_manager')), (4, ref('base.group_partner_manager'))]" />
      <field name="arch" type="xml">
        <xpath expr="//div[@name='button_box']" position="inside">
          <button class="oe_inline oe_stat_button" type="action" name="%(survey.action_survey_user_input)d" icon="fa-edit" context="{'default_lead_id': active_id, 'search_default_lead_id': active_id, 'default_partner_id': partner_id, 'default_duration': 1.0}">
            <field string="Answers" name="survey_count" widget="statinfo" />
          </button>
        </xpath>
      </field>
    </record>
    <record model="ir.ui.view" id="crm_case_form_view_oppor">
      <field name="name">Opportunities</field>
      <field name="model">crm.lead</field>
      <field name="inherit_id" ref="crm.crm_case_form_view_oppor" />
      <field name="groups_id" eval="[(4, ref('sales_team.group_sale_manager')), (4, ref('base.group_partner_manager'))]" />
      <field name="arch" type="xml">
        <xpath expr="//div[@name='button_box']" position="inside">
          <button class="oe_inline oe_stat_button" type="action" name="%(survey.action_survey_user_input)d" icon="fa-edit" context="{'default_lead_id': active_id, 'search_default_lead_id': active_id, 'default_partner_id': partner_id, 'default_duration': 1.0}">
            <field string="Answers" name="survey_count" widget="statinfo" />
          </button>
        </xpath>
      </field>
    </record>
    <record id="view_partners_form_crm_calls" model="ir.ui.view">
      <field name="name">view.res.partner.form.crm.inherited.calls</field>
      <field name="model">res.partner</field>
      <field name="inherit_id" ref="base.view_partner_form" />
      <field name="groups_id" eval="[(4, ref('sales_team.group_sale_manager')), (4, ref('base.group_partner_manager'))]" />
      <field eval="18" name="priority" />
      <field name="arch" type="xml">
        <data>
          <xpath expr="//div[@name='button_box']" position="inside">
            <button class="oe_inline oe_stat_button" type="action" name="%(survey.action_survey_user_input)d" icon="fa-edit" context="{'search_default_partner_id': active_id, 'default_partner_id': active_id}">
              <field string="Answers" name="survey_count" widget="statinfo" />
            </button>
          </xpath>
        </data>
      </field>
    </record>
    <record model="ir.ui.view" id="crm_case_form_view_oppor">
      <field name="name">Opportunities</field>
      <field name="model">crm.lead</field>
      <field name="inherit_id" ref="crm.crm_case_form_view_oppor" />
      <field name="arch" type="xml">
        <xpath expr="//div[@name='button_box']" position="inside">
          <button class="oe_inline oe_stat_button" type="action" name="%(survey.action_survey_user_input)d" icon="fa-edit" context="{'default_lead_id': active_id, 'search_default_lead_id': active_id, 'default_partner_id': partner_id, 'default_duration': 1.0}">
            <field string="Answers" name="survey_count" widget="statinfo" />
          </button>
        </xpath>
      </field>
    </record>
    <!-- Wizard -->
    <record id="view_survey_wizard" model="ir.ui.view">
      <field name="name">crm.phonecall.wizard</field>
      <field name="model">crm.phonecall.survey.wizard</field>
      <field name="type">form</field>
      <field name="arch" type="xml">
        <form string="Survey">
          <sheet>
            <group>
              <field name="survey_id" />
            </group>
          </sheet>
          <footer>
            <div>
              <button name="confirm" string="Confirm" type="object" class="oe_highlight" />
              or
              <button special="cancel" string="Cancel" class="oe_link" />
            </div>
          </footer>
        </form>
      </field>
    </record>
    <!-- Survey User Input -->
    <record id="survey_user_input_search" model="ir.ui.view">
      <field name="name">survey_user_input_search_phonecall</field>
      <field name="model">survey.user_input</field>
      <field name="inherit_id" ref="survey.survey_user_input_search" />
      <field name="arch" type="xml">
        <filter name="group_by_survey" position='inside'>
          <filter string="Lead/Opportunity" domain="[]" context="{'group_by': 'lead_id'}" />
          <filter string="Phonecall" domain="[]" context="{'group_by': 'phonecall_id'}" />
        </filter>
        <field name="partner_id" position='after'>
          <field name="lead_id" />
          <field name="phonecall_id" />
        </field>
      </field>
    </record>
    <record model="ir.ui.view" id="survey_form">
      <field name="name">survey.model_id</field>
      <field name="model">survey.survey</field>
      <field name="inherit_id" ref="survey.survey_form" />
      <field name="arch" type="xml">
        <field name="auth_required" position="after">
          <field name="model_id" />
        </field>
      </field>
    </record>
  </data>
</openerp>
